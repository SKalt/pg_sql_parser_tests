{
  "stmts": [
    {
      "stmt": {
        "CreateFunctionStmt": {
          "funcname": [
            {
              "String": {
                "str": "cs_update_referrer_type_proc"
              }
            }
          ],
          "is_procedure": true,
          "options": [
            {
              "DefElem": {
                "arg": {
                  "List": {
                    "items": [
                      {
                        "String": {
                          "str": "\nDECLARE\n    referrer_keys CURSOR IS\n        SELECT * FROM cs_referrer_keys\n        ORDER BY try_order;\n    func_body text;\n    func_cmd text;\nBEGIN\n    func_body := 'BEGIN';\n\n    FOR referrer_key IN referrer_keys LOOP\n        func_body := func_body ||\n          ' IF v_' || referrer_key.kind\n          || ' LIKE ' || quote_literal(referrer_key.key_string)\n          || ' THEN RETURN ' || quote_literal(referrer_key.referrer_type)\n          || '; END IF;' ;\n    END LOOP;\n\n    func_body := func_body || ' RETURN NULL; END;';\n\n    func_cmd :=\n      'CREATE OR REPLACE FUNCTION cs_find_referrer_type(v_host varchar,\n                                                        v_domain varchar,\n                                                        v_url varchar)\n        RETURNS varchar AS '\n      || quote_literal(func_body)\n      || ' LANGUAGE plpgsql;' ;\n\n    EXECUTE func_cmd;\nEND;\n"
                        }
                      }
                    ]
                  }
                },
                "defaction": "DEFELEM_UNSPEC",
                "defname": "as",
                "location": 59
              }
            },
            {
              "DefElem": {
                "arg": {
                  "String": {
                    "str": "plpgsql"
                  }
                },
                "defaction": "DEFELEM_UNSPEC",
                "defname": "language",
                "location": 957
              }
            }
          ],
          "replace": true
        }
      },
      "stmt_len": 973
    }
  ],
  "version": 130003
}