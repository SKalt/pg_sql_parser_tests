{
  "stmts": [
    {
      "stmt": {
        "CreateFunctionStmt": {
          "funcname": [
            {
              "String": {
                "str": "no_rewrite"
              }
            }
          ],
          "options": [
            {
              "DefElem": {
                "arg": {
                  "String": {
                    "str": "plpgsql"
                  }
                },
                "defaction": "DEFELEM_UNSPEC",
                "defname": "language",
                "location": 64
              }
            },
            {
              "DefElem": {
                "arg": {
                  "List": {
                    "items": [
                      {
                        "String": {
                          "str": "\n---\n--- Implement local Table Rewriting policy:\n---   public.foo is not allowed rewriting, ever\n---   other tables are only allowed rewriting between 1am and 6am\n---   unless they have more than 100 blocks\n---\nDECLARE\n  table_oid oid := pg_event_trigger_table_rewrite_oid();\n  current_hour integer := extract('hour' from current_time);\n  pages integer;\n  max_pages integer := 100;\nBEGIN\n  IF pg_event_trigger_table_rewrite_oid() = 'public.foo'::regclass\n  THEN\n        RAISE EXCEPTION 'you''re not allowed to rewrite the table %',\n                        table_oid::regclass;\n  END IF;\n\n  SELECT INTO pages relpages FROM pg_class WHERE oid = table_oid;\n  IF pages \u003e max_pages\n  THEN\n        RAISE EXCEPTION 'rewrites only allowed for table with less than % pages',\n                        max_pages;\n  END IF;\n\n  IF current_hour NOT BETWEEN 1 AND 6\n  THEN\n        RAISE EXCEPTION 'rewrites only allowed between 1am and 6am';\n  END IF;\nEND;\n"
                        }
                      }
                    ]
                  }
                },
                "defaction": "DEFELEM_UNSPEC",
                "defname": "as",
                "location": 81
              }
            }
          ],
          "replace": true,
          "returnType": {
            "location": 49,
            "names": [
              {
                "String": {
                  "str": "event_trigger"
                }
              }
            ],
            "typemod": -1
          }
        }
      },
      "stmt_len": 1029
    },
    {
      "stmt": {
        "CreateEventTrigStmt": {
          "eventname": "table_rewrite",
          "funcname": [
            {
              "String": {
                "str": "no_rewrite"
              }
            }
          ],
          "trigname": "no_rewrite_allowed"
        }
      },
      "stmt_len": 109,
      "stmt_location": 1030
    }
  ],
  "version": 130003
}