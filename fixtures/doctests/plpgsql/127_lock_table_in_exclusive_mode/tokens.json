[
  {
    "Name": "CREATE",
    "Start": 0,
    "End": 6,
    "Text": "CREATE"
  },
  {
    "Name": "OR",
    "Start": 7,
    "End": 9,
    "Text": "OR"
  },
  {
    "Name": "REPLACE",
    "Start": 10,
    "End": 17,
    "Text": "REPLACE"
  },
  {
    "Name": "PROCEDURE",
    "Start": 18,
    "End": 27,
    "Text": "PROCEDURE"
  },
  {
    "Name": "IDENT",
    "Start": 28,
    "End": 41,
    "Text": "cs_create_job"
  },
  {
    "Name": "ASCII_40",
    "Start": 41,
    "End": 42,
    "Text": "("
  },
  {
    "Name": "IDENT",
    "Start": 42,
    "End": 50,
    "Text": "v_job_id"
  },
  {
    "Name": "INTEGER",
    "Start": 51,
    "End": 58,
    "Text": "integer"
  },
  {
    "Name": "ASCII_41",
    "Start": 58,
    "End": 59,
    "Text": ")"
  },
  {
    "Name": "AS",
    "Start": 60,
    "End": 62,
    "Text": "AS"
  },
  {
    "Name": "SCONST",
    "Start": 63,
    "End": 708,
    "Text": "$$\nDECLARE\n    a_running_job_count integer;\nBEGIN\n    LOCK TABLE cs_jobs IN EXCLUSIVE MODE;\n\n    SELECT count(*) INTO a_running_job_count FROM cs_jobs WHERE end_stamp IS NULL;\n\n    IF a_running_job_count \u003e 0 THEN\n        COMMIT; -- free lock\n        RAISE EXCEPTION 'Unable to create a new job: a job is currently running'; -- \n    END IF;\n\n    DELETE FROM cs_active_job;\n    INSERT INTO cs_active_job(job_id) VALUES (v_job_id);\n\n    BEGIN\n        INSERT INTO cs_jobs (job_id, start_stamp) VALUES (v_job_id, now());\n    EXCEPTION\n        WHEN unique_violation THEN -- \n            -- don't worry if it already exists\n    END;\n    COMMIT;\nEND;\n$$"
  },
  {
    "Name": "LANGUAGE",
    "Start": 709,
    "End": 717,
    "Text": "LANGUAGE"
  },
  {
    "Name": "IDENT",
    "Start": 718,
    "End": 725,
    "Text": "plpgsql"
  },
  {
    "Name": "ASCII_59",
    "Start": 725,
    "End": 726,
    "Text": ";"
  }
]